What's happening is that R and Stata use quite different approaches to estimating the population standard deviation. R goes directly via the mean of $(X-\bar X)^2$ and Stata goes via an estimated standard error of the mean (under simple random sampling). ..As a result, Stata's estimate depends on values outside the subpopulation (as is unarguably correct for the standard error of the mean) and R's doesn't (as is at least arguably correct for the subpopulation standard deviation).  ..For example, you can get the 2.198 in the Stata output as..&gt; sqrt(2.47162^2*571.16/139.77*6/31).[1] 2.198105...where 2.47162 is the R estimate, 571.16 is the estimated population size (sum of weights), 139.77 is the estimated subpopulation size (sum of weights), 6 is 7-1 and 31 is 32-1. ..As you can see, it isn't easy to convert; it's probably easier to just implement the formula from the Stata manual if you want the Stata version..
